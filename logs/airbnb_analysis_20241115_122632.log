2024-11-15 12:26:32,462 [INFO] advanced_analyzer.py:362 - === 开始Airbnb数据收集程序 ===
2024-11-15 12:26:32,653 [INFO] advanced_analyzer.py:99 - 成功读取 6 个房间ID
2024-11-15 12:26:32,653 [INFO] advanced_analyzer.py:373 - 生成 6 个URL
2024-11-15 12:26:32,653 [INFO] advanced_analyzer.py:377 - 创建数据目录: data/airbnb_data_20241115_122632
2024-11-15 12:26:32,654 [INFO] advanced_analyzer.py:231 - === 开始批量分析房源 ===
2024-11-15 12:26:32,654 [INFO] advanced_analyzer.py:240 - 设置并发线程数: 1
2024-11-15 12:26:32,683 [INFO] bit_browser_manager.py:47 - 活动浏览器响应: {
  "success": true,
  "data": {
    "cf51683770d94ff3931408fce73c90f3": 31680,
    "31a9dd5e4682492e93b471c7d0429739": 13856
  }
}
2024-11-15 12:26:32,683 [INFO] bit_browser_manager.py:55 - 找到活动浏览器 ID: cf51683770d94ff3931408fce73c90f3, PID: 31680
2024-11-15 12:26:32,686 [INFO] bit_browser_manager.py:151 - 打开浏览器响应: {
  "success": true,
  "data": {
    "ws": "ws://127.0.0.1:64147/devtools/browser/ad368a18-6d69-44f4-872a-1459059a9415",
    "http": "127.0.0.1:64147",
    "coreVersion": "126",
    "driver": "C:\\Users\\jiann\\AppData\\Roaming\\BitBrowser\\chromedriver\\126\\chromedriver.exe",
    "seq": 1,
    "name": "",
    "remark": "",
    "pid": 31680
  }
}
2024-11-15 12:26:32,686 [INFO] bit_browser_manager.py:158 - 调试地址: 127.0.0.1:64147
2024-11-15 12:26:32,686 [INFO] bit_browser_manager.py:159 - Driver路径: C:\Users\jiann\AppData\Roaming\BitBrowser\chromedriver\126\chromedriver.exe
2024-11-15 12:26:33,264 [INFO] bit_browser_manager.py:182 - 正在导航到: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:26:34,010 [INFO] bit_browser_manager.py:184 - 成功加载页面: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:26:39,010 [INFO] advanced_analyzer.py:196 - 
开始分析房源: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:26:39,010 [INFO] airbnb_calendar_checker.py:70 - 开始检查房源日历: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:26:39,202 [INFO] airbnb_calendar_checker.py:75 - 页面加载中...
2024-11-15 12:26:39,205 [INFO] airbnb_calendar_checker.py:82 - 页面基本加载完成
2024-11-15 12:27:39,422 [INFO] airbnb_calendar_checker.py:120 - 找到日历按钮: //button[contains(@aria-label, 'Choose')]
2024-11-15 12:27:39,426 [INFO] airbnb_calendar_checker.py:134 - 已滚动到日历按钮位置
2024-11-15 12:27:40,426 [INFO] airbnb_calendar_checker.py:139 - 日历按钮已准备就绪
2024-11-15 12:27:40,553 [INFO] airbnb_calendar_checker.py:148 - 直接点击日历按钮成功
2024-11-15 12:28:00,604 [INFO] airbnb_calendar_checker.py:184 - 日历内容已加载: //div[contains(@data-testid, 'calendar')]
2024-11-15 12:28:00,614 [INFO] airbnb_calendar_checker.py:199 - 找到 92 个日期单元格
2024-11-15 12:28:00,703 [INFO] airbnb_calendar_checker.py:211 - 找到 92 个日期单元格
2024-11-15 12:28:00,704 [INFO] airbnb_calendar_checker.py:256 - 原始单元格数量: 92
2024-11-15 12:28:00,704 [INFO] airbnb_calendar_checker.py:257 - 去重后数据条数: 92
2024-11-15 12:28:00,705 [INFO] airbnb_calendar_checker.py:258 - 处理的唯一日期数: 92
2024-11-15 12:28:00,705 [INFO] airbnb_calendar_checker.py:262 - 收集到 92 条有效日历数据
2024-11-15 12:28:00,705 [INFO] airbnb_calendar_checker.py:22 - 开始导出数据到Excel...
2024-11-15 12:28:00,705 [INFO] airbnb_calendar_checker.py:32 - 处理房源ID: 837352260137971048
2024-11-15 12:28:00,705 [INFO] airbnb_calendar_checker.py:37 - 将创建文件: data/airbnb_calendar_837352260137971048_20241115_122800.xlsx
2024-11-15 12:28:00,705 [INFO] airbnb_calendar_checker.py:41 - 创建DataFrame，共 92 行数据
2024-11-15 12:28:00,729 [INFO] airbnb_calendar_checker.py:52 - 数据已成功导出到Excel文件: data/airbnb_calendar_837352260137971048_20241115_122800.xlsx
2024-11-15 12:28:00,729 [INFO] airbnb_calendar_checker.py:57 - 文件创建成功，大小: 8.16 KB
2024-11-15 12:28:00,729 [INFO] airbnb_calendar_checker.py:265 - 日历数据已成功导出到: data/airbnb_calendar_837352260137971048_20241115_122800.xlsx
2024-11-15 12:28:00,729 [INFO] advanced_analyzer.py:205 - 成功获取日历数据: 92 条记录
2024-11-15 12:28:00,729 [INFO] price_checker.py:537 - 开始检查房源价格: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:28:00,730 [INFO] price_checker.py:530 - 找到 21 个可预订日期
2024-11-15 12:28:00,730 [INFO] price_checker.py:553 - [1/21] 处理日期: 11/18/2024
2024-11-15 12:28:00,730 [INFO] price_checker.py:254 - 开始获取价格信息: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:28:00,730 [INFO] price_checker.py:255 - 入住日期: 11/18/2024
2024-11-15 12:28:05,885 [ERROR] price_checker.py:462 - 获取价格信息时发生错误: time data '11/18/2024' does not match format '%d/%m/%Y'
2024-11-15 12:28:05,885 [ERROR] price_checker.py:463 - 错误详情: ValueError
2024-11-15 12:28:05,895 [ERROR] price_checker.py:464 - 错误堆栈: Traceback (most recent call last):
  File "C:\GitWork\Airbnb data Analyst\price_checker.py", line 263, in get_price_info
    date_str = datetime.strptime(checkin_date, '%d/%m/%Y').strftime('%d/%m/%Y')
               ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 573, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
                                    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 352, in _strptime
    raise ValueError("time data %r does not match format %r" %
                     (data_string, format))
ValueError: time data '11/18/2024' does not match format '%d/%m/%Y'

2024-11-15 12:28:05,895 [WARNING] price_checker.py:569 - ✗ 获取 11/18/2024 的价格信息失败
2024-11-15 12:28:05,895 [INFO] price_checker.py:553 - [2/21] 处理日期: 11/27/2024
2024-11-15 12:28:05,895 [INFO] price_checker.py:254 - 开始获取价格信息: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:28:05,895 [INFO] price_checker.py:255 - 入住日期: 11/27/2024
2024-11-15 12:28:11,069 [ERROR] price_checker.py:462 - 获取价格信息时发生错误: time data '11/27/2024' does not match format '%d/%m/%Y'
2024-11-15 12:28:11,069 [ERROR] price_checker.py:463 - 错误详情: ValueError
2024-11-15 12:28:11,070 [ERROR] price_checker.py:464 - 错误堆栈: Traceback (most recent call last):
  File "C:\GitWork\Airbnb data Analyst\price_checker.py", line 263, in get_price_info
    date_str = datetime.strptime(checkin_date, '%d/%m/%Y').strftime('%d/%m/%Y')
               ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 573, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
                                    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 352, in _strptime
    raise ValueError("time data %r does not match format %r" %
                     (data_string, format))
ValueError: time data '11/27/2024' does not match format '%d/%m/%Y'

2024-11-15 12:28:11,070 [WARNING] price_checker.py:569 - ✗ 获取 11/27/2024 的价格信息失败
2024-11-15 12:28:11,070 [INFO] price_checker.py:553 - [3/21] 处理日期: 11/28/2024
2024-11-15 12:28:11,070 [INFO] price_checker.py:254 - 开始获取价格信息: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:28:11,070 [INFO] price_checker.py:255 - 入住日期: 11/28/2024
2024-11-15 12:28:16,219 [ERROR] price_checker.py:462 - 获取价格信息时发生错误: time data '11/28/2024' does not match format '%d/%m/%Y'
2024-11-15 12:28:16,219 [ERROR] price_checker.py:463 - 错误详情: ValueError
2024-11-15 12:28:16,220 [ERROR] price_checker.py:464 - 错误堆栈: Traceback (most recent call last):
  File "C:\GitWork\Airbnb data Analyst\price_checker.py", line 263, in get_price_info
    date_str = datetime.strptime(checkin_date, '%d/%m/%Y').strftime('%d/%m/%Y')
               ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 573, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
                                    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 352, in _strptime
    raise ValueError("time data %r does not match format %r" %
                     (data_string, format))
ValueError: time data '11/28/2024' does not match format '%d/%m/%Y'

2024-11-15 12:28:16,220 [WARNING] price_checker.py:569 - ✗ 获取 11/28/2024 的价格信息失败
2024-11-15 12:28:16,220 [INFO] price_checker.py:553 - [4/21] 处理日期: 11/29/2024
2024-11-15 12:28:16,220 [INFO] price_checker.py:254 - 开始获取价格信息: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:28:16,220 [INFO] price_checker.py:255 - 入住日期: 11/29/2024
2024-11-15 12:28:21,371 [ERROR] price_checker.py:462 - 获取价格信息时发生错误: time data '11/29/2024' does not match format '%d/%m/%Y'
2024-11-15 12:28:21,371 [ERROR] price_checker.py:463 - 错误详情: ValueError
2024-11-15 12:28:21,372 [ERROR] price_checker.py:464 - 错误堆栈: Traceback (most recent call last):
  File "C:\GitWork\Airbnb data Analyst\price_checker.py", line 263, in get_price_info
    date_str = datetime.strptime(checkin_date, '%d/%m/%Y').strftime('%d/%m/%Y')
               ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 573, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
                                    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 352, in _strptime
    raise ValueError("time data %r does not match format %r" %
                     (data_string, format))
ValueError: time data '11/29/2024' does not match format '%d/%m/%Y'

2024-11-15 12:28:21,372 [WARNING] price_checker.py:569 - ✗ 获取 11/29/2024 的价格信息失败
2024-11-15 12:28:21,372 [INFO] price_checker.py:553 - [5/21] 处理日期: 11/30/2024
2024-11-15 12:28:21,372 [INFO] price_checker.py:254 - 开始获取价格信息: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:28:21,372 [INFO] price_checker.py:255 - 入住日期: 11/30/2024
2024-11-15 12:28:26,486 [ERROR] price_checker.py:462 - 获取价格信息时发生错误: time data '11/30/2024' does not match format '%d/%m/%Y'
2024-11-15 12:28:26,486 [ERROR] price_checker.py:463 - 错误详情: ValueError
2024-11-15 12:28:26,488 [ERROR] price_checker.py:464 - 错误堆栈: Traceback (most recent call last):
  File "C:\GitWork\Airbnb data Analyst\price_checker.py", line 263, in get_price_info
    # 使用显式等待替代固定等待时间
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 573, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
                                    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\_strptime.py", line 352, in _strptime
    raise ValueError("time data %r does not match format %r" %
                     (data_string, format))
ValueError: time data '11/30/2024' does not match format '%d/%m/%Y'

2024-11-15 12:28:26,488 [WARNING] price_checker.py:569 - ✗ 获取 11/30/2024 的价格信息失败
2024-11-15 12:28:26,488 [INFO] price_checker.py:573 - 已完成 5/21 个日期的处理
2024-11-15 12:28:36,488 [INFO] price_checker.py:553 - [6/21] 处理日期: 12/01/2024
2024-11-15 12:28:36,488 [INFO] price_checker.py:254 - 开始获取价格信息: https://www.airbnb.com/rooms/837352260137971048
2024-11-15 12:28:36,488 [INFO] price_checker.py:255 - 入住日期: 12/01/2024
2024-11-15 12:28:41,663 [INFO] price_checker.py:271 - 开始检查日期 12/01/2024 的最小入住要求...
2024-11-15 12:28:41,669 [INFO] price_checker.py:152 - 初始元素HTML: <td class="_1t09kc0t" role="button" aria-disabled="false" aria-label="1, Sunday, December 2024. Available. There is a 1 night minimum stay requirement. Select as check-in date. " tabindex="-1" style="width: 78px; height: 78px;"><div class="_5nf23wc notranslate" data-testid="calendar-day-12/01/2024" data-is-day-blocked="false" style="width: 78px; height: 78px;">1</div></td>
2024-11-15 12:28:41,680 [INFO] price_checker.py:158 - 找到日期: 12/01/2024
2024-11-15 12:28:41,680 [INFO] price_checker.py:164 - 点击日期元素...
2024-11-15 12:28:51,730 [WARNING] price_checker.py:169 - 点击日期元素失败，尝试使用JavaScript点击: Message: element not interactable
  (Session info: chrome=126.0.6478.255)
Stacktrace:
	GetHandleVerifier [0x00A7FD33+27651]
	(No symbol) [0x00A15554]
	(No symbol) [0x0091195D]
	(No symbol) [0x00953BE4]
	(No symbol) [0x0094912F]
	(No symbol) [0x0097390C]
	(No symbol) [0x00948BB5]
	(No symbol) [0x00973BA4]
	(No symbol) [0x0098CA7D]
	(No symbol) [0x009736A6]
	(No symbol) [0x009474E1]
	(No symbol) [0x0094805D]
	GetHandleVerifier [0x00D36613+2872547]
	GetHandleVerifier [0x00D8BADD+3221933]
	GetHandleVerifier [0x00B02A94+563556]
	GetHandleVerifier [0x00B09DCC+593052]
	(No symbol) [0x00A1E3A4]
	(No symbol) [0x00A1AE08]
	(No symbol) [0x00A1AFA7]
	(No symbol) [0x00A0D0AE]
	BaseThreadInitThunk [0x74D37BA9+25]
	RtlInitializeExceptionChain [0x7704C0CB+107]
	RtlClearBits [0x7704C04F+191]

2024-11-15 12:28:52,842 [INFO] price_checker.py:174 - 移动到日期元素...
2024-11-15 12:28:52,848 [ERROR] price_checker.py:245 - 检查最小入住天数时出错: Message: stale element reference: stale element not found in the current frame
  (Session info: chrome=126.0.6478.255); For documentation on this error, please visit: https://www.selenium.dev/documentation/webdriver/troubleshooting/errors#stale-element-reference-exception
Stacktrace:
	GetHandleVerifier [0x00A7FD33+27651]
	(No symbol) [0x00A15554]
	(No symbol) [0x00911ADF]
	(No symbol) [0x00916BCF]
	(No symbol) [0x00918858]
	(No symbol) [0x009188D0]
	(No symbol) [0x0095830E]
	(No symbol) [0x00957885]
	(No symbol) [0x00993FA0]
	(No symbol) [0x0097390C]
	(No symbol) [0x0098CA7D]
	(No symbol) [0x009736A6]
	(No symbol) [0x009474E1]
	(No symbol) [0x0094805D]
	GetHandleVerifier [0x00D36613+2872547]
	GetHandleVerifier [0x00D8BADD+3221933]
	GetHandleVerifier [0x00B02A94+563556]
	GetHandleVerifier [0x00B09DCC+593052]
	(No symbol) [0x00A1E3A4]
	(No symbol) [0x00A1AE08]
	(No symbol) [0x00A1AFA7]
	(No symbol) [0x00A0D0AE]
	BaseThreadInitThunk [0x74D37BA9+25]
	RtlInitializeExceptionChain [0x7704C0CB+107]
	RtlClearBits [0x7704C04F+191]

2024-11-15 12:28:52,848 [ERROR] price_checker.py:246 - 错误类型: StaleElementReferenceException
2024-11-15 12:28:52,857 [ERROR] price_checker.py:247 - 错误堆栈: Traceback (most recent call last):
  File "C:\GitWork\Airbnb data Analyst\price_checker.py", line 176, in min_nights_check
    actions.move_to_element(date_element).perform()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\action_chains.py", line 94, in perform
    self.w3c_actions.perform()
    ~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\actions\action_builder.py", line 96, in perform
    self.driver.execute(Command.W3C_ACTIONS, enc)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 380, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\jiann\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 229, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.StaleElementReferenceException: Message: stale element reference: stale element not found in the current frame
  (Session info: chrome=126.0.6478.255); For documentation on this error, please visit: https://www.selenium.dev/documentation/webdriver/troubleshooting/errors#stale-element-reference-exception
Stacktrace:
	GetHandleVerifier [0x00A7FD33+27651]
	(No symbol) [0x00A15554]
	(No symbol) [0x00911ADF]
	(No symbol) [0x00916BCF]
	(No symbol) [0x00918858]
	(No symbol) [0x009188D0]
	(No symbol) [0x0095830E]
	(No symbol) [0x00957885]
	(No symbol) [0x00993FA0]
	(No symbol) [0x0097390C]
	(No symbol) [0x0098CA7D]
	(No symbol) [0x009736A6]
	(No symbol) [0x009474E1]
	(No symbol) [0x0094805D]
	GetHandleVerifier [0x00D36613+2872547]
	GetHandleVerifier [0x00D8BADD+3221933]
	GetHandleVerifier [0x00B02A94+563556]
	GetHandleVerifier [0x00B09DCC+593052]
	(No symbol) [0x00A1E3A4]
	(No symbol) [0x00A1AE08]
	(No symbol) [0x00A1AFA7]
	(No symbol) [0x00A0D0AE]
	BaseThreadInitThunk [0x74D37BA9+25]
	RtlInitializeExceptionChain [0x7704C0CB+107]
	RtlClearBits [0x7704C04F+191]


2024-11-15 12:28:52,857 [WARNING] price_checker.py:248 - 使用默认值1晚
2024-11-15 12:28:52,857 [INFO] price_checker.py:273 - 最终使用的最小入住天数: 1晚 (自动检测)
2024-11-15 12:28:52,858 [INFO] price_checker.py:296 - 访问URL: https://www.airbnb.com/rooms/837352260137971048?check_in=2024-01-12&check_out=2024-01-13&adults=3&children=0&infants=0
2024-11-15 12:28:58,007 [INFO] price_checker.py:303 - 检查页面状态...
2024-11-15 12:28:58,010 [INFO] price_checker.py:305 - 页面状态: complete
2024-11-15 12:29:00,021 [INFO] price_checker.py:318 - 价格容器已加载并可见
2024-11-15 12:29:00,022 [INFO] price_checker.py:327 - 尝试价格选择器: xpath - //div[@data-testid='book-it-default']//span[contains(@class, '_1y74zjx')]
